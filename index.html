<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reino das Tenebras Insetas</title>
    <style>
        body {
            margin: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        canvas {
            border: 2px solid #2d3a5f;
            background: #1a1a2e;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="450"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Protagonista
        const player = {
            x: 100,
            y: 200,
            width: 20,
            height: 30,
            speed: 3,
            color: '#c2c8e4',
            isDashing: false,
            dashSpeed: 8,
            dashTime: 0,
            isAttacking: false,
            attackTime: 0,
            attackRange: 30,
            attackColor: 'rgba(255, 200, 100, 0.8)',
            attackDamage: 1 // Dano do ataque
        };

        // Mobs (insetos inimigos)
        let mobs = [
            { x: 300, y: 390, width: 25, height: 25, color: '#d64545', speed: 1, isStunned: false, stunTime: 0, health: 2 },
            { x: 600, y: 270, width: 25, height: 25, color: '#d64545', speed: 1.2, isStunned: false, stunTime: 0, health: 3 }
        ];

        // Ambiente (cidade esquecida)
        const platforms = [
            { x: 0, y: 420, width: 800, height: 30, color: '#2d3a5f' },
            { x: 200, y: 350, width: 150, height: 20, color: '#2d3a5f' },
            { x: 500, y: 300, width: 150, height: 20, color: '#2d3a5f' }
        ];

        // Partículas de poeira
        const dustParticles = [];
        for (let i = 0; i < 30; i++) {
            dustParticles.push({
                x: Math.random() * 800,
                y: Math.random() * 450,
                size: Math.random() * 2,
                speed: Math.random() * 0.2
            });
        }

        // Controles
        const keys = {
            left: false,
            right: false,
            up: false,
            dash: false,
            attack: false
        };

        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft': keys.left = true; break;
                case 'ArrowRight': keys.right = true; break;
                case 'ArrowUp': keys.up = true; break;
                case 'Shift': keys.dash = true; break;
                case ' ': keys.attack = true; break; // Barra de espaço para atacar
            }
        });

        document.addEventListener('keyup', (e) => {
            switch(e.key) {
                case 'ArrowLeft': keys.left = false; break;
                case 'ArrowRight': keys.right = false; break;
                case 'ArrowUp': keys.up = false; break;
                case 'Shift': keys.dash = false; player.isDashing = false; break;
                case ' ': keys.attack = false; break;
            }
        });

        // Verifica colisão
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // Atualização do jogo
        function update() {
            // Movimento do jogador
            if (keys.dash) {
                player.isDashing = true;
                player.dashTime = 10;
            }

            if (player.isDashing && player.dashTime > 0) {
                player.x += keys.left ? -player.dashSpeed : keys.right ? player.dashSpeed : 0;
                player.dashTime--;
            } else if (!player.isAttacking) {
                player.x += keys.left ? -player.speed : keys.right ? player.speed : 0;
            }

            // Ataque
            if (keys.attack && !player.isAttacking) {
                player.isAttacking = true;
                player.attackTime = 5;

                // Definir área de ataque
                const attackHitbox = {
                    x: keys.right ? player.x + player.width : player.x - player.attackRange,
                    y: player.y,
                    width: player.attackRange,
                    height: player.height
                };

                // Aplica dano e stun nos mobs colididos
                mobs = mobs.map(mob => {
                    if (checkCollision(attackHitbox, mob)) {
                        mob.health -= player.attackDamage;
                        mob.isStunned = true;
                        mob.stunTime = 30;
                        mob.color = '#f1c40f'; // Cor amarela durante stun
                    }
                    return mob;
                }).filter(mob => mob.health > 0); // Remove mobs com vida <= 0
            }

            if (player.isAttacking && player.attackTime > 0) {
                player.attackTime--;
            } else {
                player.isAttacking = false;
            }

            // Limites da tela
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

            // Atualiza mobs
            mobs.forEach(mob => {
                if (mob.isStunned) {
                    mob.stunTime--;
                    if (mob.stunTime <= 0) {
                        mob.isStunned = false;
                        mob.color = '#d64545'; // Cor original
                    }
                } else {
                    // Movimento do mob em direção ao jogador
                    if (mob.x < player.x) mob.x += mob.speed;
                    else mob.x -= mob.speed;
                }

                // Colisão com plataformas (mantém mob na plataforma)
                platforms.forEach(plat => {
                    if (mob.y + mob.height < plat.y && mob.x + mob.width > plat.x && mob.x < plat.x + plat.width) {
                        mob.y = plat.y - mob.height;
                    }
                });
            });

            // Atualiza poeira
            dustParticles.forEach(p => {
                p.y += p.speed;
                if (p.y > canvas.height) p.y = 0;
            });
        }

        // Desenho
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Poeira
            dustParticles.forEach(p => {
                ctx.fillStyle = 'rgba(200, 200, 220, 0.5)';
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });

            // Plataformas
            platforms.forEach(plat => {
                ctx.fillStyle = plat.color;
                ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
                // Detalhes das ruínas
                ctx.fillStyle = '#1e2749';
                ctx.fillRect(plat.x + 10, plat.y - 5, plat.width - 20, 5);
            });

            // Ataque
            if (player.isAttacking) {
                ctx.fillStyle = player.attackColor;
                if (keys.right) {
                    ctx.fillRect(player.x + player.width, player.y, player.attackRange, player.height);
                } else {
                    ctx.fillRect(player.x - player.attackRange, player.y, player.attackRange, player.height);
                }
            }

            // Protagonista
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            // "Armadura"
            ctx.fillStyle = '#a8acc9';
            ctx.fillRect(player.x + 5, player.y, 10, 5);
            ctx.fillRect(player.x + 2, player.y + 25, 16, 5);

            // Mobs e barra de vida
            mobs.forEach(mob => {
                // Desenha mob
                ctx.fillStyle = mob.color;
                ctx.fillRect(mob.x, mob.y, mob.width, mob.height);
                // Olhos do mob
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(mob.x + 8, mob.y + 8, 3, 0, Math.PI * 2);
                ctx.arc(mob.x + 17, mob.y + 8, 3, 0, Math.PI * 2);
                ctx.fill();

                // Barra de vida
                ctx.fillStyle = '#34495e';
                ctx.fillRect(mob.x - 2, mob.y - 8, mob.width + 4, 4);
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(mob.x - 2, mob.y - 8, (mob.width + 4) * (mob.health / 3), 4); // Vida máxima 3
            });
        }

        // Loop do jogo
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
