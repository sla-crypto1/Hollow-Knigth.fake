<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vespera: Mobile Edition</title>
    <style>
        body { margin: 0; background: #0a0a0c; overflow: hidden; font-family: sans-serif; user-select: none; }
        canvas { display: block; background: #16161d; touch-action: none; }
        
        /* Estilo dos Controles Mobile */
        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            box-sizing: border-box;
            pointer-events: none;
        }
        .btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            pointer-events: auto;
            touch-action: manipulation;
        }
        .btn:active { background: rgba(255, 255, 255, 0.4); }
        .d-pad { display: flex; gap: 15px; }
        .actions { display: flex; gap: 15px; }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div class="controls">
        <div class="d-pad">
            <div class="btn" id="btnLeft">←</div>
            <div class="btn" id="btnRight">→</div>
        </div>
        <div class="actions">
            <div class="btn" id="btnAttack" style="background: rgba(255, 0, 0, 0.2);">X</div>
            <div class="btn" id="btnJump">↑</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Ajuste de ecrã inteiro
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        const player = {
            x: 50, y: 100,
            width: 30, height: 45,
            velX: 0, velY: 0,
            speed: 6,
            jumpForce: -13,
            gravity: 0.6,
            isGrounded: false,
            isAttacking: false,
            attackTimer: 0,
            facingRight: true
        };

        const platforms = [
            { x: 0, y: canvas.height - 100, w: 2000, h: 100 }, // Chão longo
            { x: 300, y: canvas.height - 250, w: 200, h: 20 },
            { x: 600, y: canvas.height - 350, w: 150, h: 20 }
        ];

        const input = { left: false, right: false, jump: false, attack: false };

        // --- LÓGICA DE INPUT (TECLADO + TOUCH) ---
        const setupButton = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); input[key] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); input[key] = false; });
            el.addEventListener('mousedown', () => input[key] = true);
            el.addEventListener('mouseup', () => input[key] = false);
        };

        setupButton('btnLeft', 'left');
        setupButton('btnRight', 'right');
        setupButton('btnJump', 'jump');
        setupButton('btnAttack', 'attack');

        window.addEventListener('keydown', e => {
            if(e.code === 'ArrowLeft') input.left = true;
            if(e.code === 'ArrowRight') input.right = true;
            if(e.code === 'Space') input.jump = true;
            if(e.code === 'KeyX') input.attack = true;
        });
        window.addEventListener('keyup', e => {
            if(e.code === 'ArrowLeft') input.left = false;
            if(e.code === 'ArrowRight') input.right = false;
            if(e.code === 'Space') input.jump = false;
            if(e.code === 'KeyX') input.attack = false;
        });

        function update() {
            // Movimento
            if (input.left) {
                player.velX = -player.speed;
                player.facingRight = false;
            } else if (input.right) {
                player.velX = player.speed;
                player.facingRight = true;
            } else {
                player.velX *= 0.8;
            }

            // Gravidade
            player.velY += player.gravity;

            // Pulo
            if (input.jump && player.isGrounded) {
                player.velY = player.jumpForce;
                player.isGrounded = false;
            }

            player.x += player.velX;
            player.y += player.velY;

            // Colisão com plataformas
            player.isGrounded = false;
            platforms.forEach(plat => {
                if (player.x < plat.x + plat.w && player.x + player.width > plat.x &&
                    player.y + player.height > plat.y && player.y + player.height < plat.y + 15) {
                    if (player.velY > 0) {
                        player.isGrounded = true;
                        player.velY = 0;
                        player.y = plat.y - player.height;
                    }
                }
            });

            // Ataque
            if (input.attack && !player.isAttacking) {
                player.isAttacking = true;
                player.attackTimer = 12;
            }
            if (player.attackTimer > 0) player.attackTimer--;
            else player.isAttacking = false;

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            ctx.fillStyle = "#16161d";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Chão e Plataformas
            ctx.fillStyle = "#2e2e35";
            platforms.forEach(plat => ctx.fillRect(plat.x, plat.y, plat.w, plat.h));

            // Efeito de Ataque
            if (player.isAttacking) {
                ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
                let attackX = player.facingRight ? player.x + player.width : player.x - 40;
                ctx.fillRect(attackX, player.y + 10, 40, 20);
            }

            // Personagem (Estilo Hollow Knight)
            ctx.fillStyle = "white";
            ctx.shadowBlur = 15;
            ctx.shadowColor = "white";
            ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.shadowBlur = 0;
        }

        update();
    </script>
</body>
</html>
